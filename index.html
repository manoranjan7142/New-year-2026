
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy New Year 2026 â€” Countdown & Greetings (Fixed)</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{--bg1:#071026;--bg2:#08142a;--accent:#FFD166;--muted:#9AA4C4;--glass: rgba(255,255,255,0.06);--card-bg: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family: 'Montserrat', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background: radial-gradient(1200px 600px at 10% 10%, rgba(10,18,36,1) 0%, rgba(11,16,26,0) 20%), linear-gradient(180deg,var(--bg1),var(--bg2));color:#e6eef8;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden;padding:20px}
    .bg-anim{position:fixed;inset:0;z-index:-4;pointer-events:none;background: linear-gradient(120deg, rgba(255,98,98,0.04), rgba(130,90,255,0.03), rgba(0,200,180,0.02));animation: bgShift 22s linear infinite;mix-blend-mode:overlay;opacity:0.9}
    @keyframes bgShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .wrap{max-width:1100px;margin:32px auto;display:grid;grid-template-columns:1fr 420px;gap:24px;align-items:start}
    header{grid-column:1/3;display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#ff9068,#ffd166);display:flex;align-items:center;justify-content:center;color:#072033;font-weight:900}
    h1{margin:0;font-size:20px}.lead{margin:0;color:var(--muted);font-size:13px}.card{background:var(--card-bg);border-radius:14px;padding:18px;box-shadow:0 12px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    .countdown-row{display:flex;gap:12px;align-items:center;justify-content:space-between}.timer{display:flex;gap:10px;flex:1;justify-content:space-between}.seg{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:12px;border-radius:10px;min-width:70px;text-align:center}.seg .num{font-size:22px;font-weight:900}.seg .lbl{font-size:11px;color:var(--muted);margin-top:6px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}select,input,button{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px}button.primary{background:linear-gradient(90deg,#FF9068,#FFD166);border:none;padding:10px 12px;border-radius:10px;font-weight:900;cursor:pointer}
    .preview{display:flex;flex-direction:column;gap:12px;min-height:260px}.card-top{display:flex;gap:12px;align-items:center}.spark{width:52px;height:52px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;background:linear-gradient(135deg,#6EF9C6,#29B6F6);color:#042033}.message{font-size:15px;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));min-height:120px;display:flex;align-items:center}.templates{display:flex;gap:8px;flex-wrap:wrap}.tpl{padding:8px 10px;border-radius:8px;background:var(--glass);cursor:pointer;font-weight:700}
    footer{grid-column:1/3;text-align:center;color:var(--muted);margin-top:20px}canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:0}
    @media (max-width:1024px){.wrap{grid-template-columns:1fr 360px}}@media (max-width:900px){.wrap{grid-template-columns:1fr} .right{order:2}}@media (max-width:480px){header{flex-direction:column;align-items:flex-start} .logo{width:48px;height:48px}}

    /* Fallback modal for copy failures */
    .fallback-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(6,10,18,0.98);padding:18px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.6);z-index:10001;min-width:260px;color:#e6eef8;display:none}
    .fallback-modal.show{display:block}
    .fallback-modal textarea{width:100%;height:90px;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#081226;color:inherit}
    .fallback-row{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit}
  </style>
</head>
<body>
  <div class="bg-anim" aria-hidden="true"></div>
  <canvas id="fxCanvas"></canvas>
  <canvas id="confettiCanvas"></canvas>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">NY26</div>
        <div>
          <h1>Countdown to New Year 2026</h1>
          <div class="lead">Realtime countdown â€¢ Greeting generator â€¢ Fireworks & shareable cards</div>
        </div>
      </div>
      <div class="lead">Welcome 2026 â€” Customize & share your wishes!</div>
    </header>

    <section class="card">
      <h3 style="margin:0 0 12px 0">Global Countdown</h3>
      <div class="countdown-row">
        <div class="timer" aria-live="polite" id="timer">
          <div class="seg"><div class="num" id="days">--</div><div class="lbl">Days</div></div>
          <div class="seg"><div class="num" id="hours">--</div><div class="lbl">Hours</div></div>
          <div class="seg"><div class="num" id="minutes">--</div><div class="lbl">Minutes</div></div>
          <div class="seg"><div class="num" id="seconds">--</div><div class="lbl">Seconds</div></div>
        </div>
      </div>

      <div class="controls">
        <label class="lead" for="tz">Timezone</label>
        <select id="tz"></select>
        <button class="primary" id="toggleSound">ðŸ”” Sound</button>
        <button id="localBtn">Local midnight</button>
        <div style="margin-left:auto;color:var(--muted)" id="targetLabel">UTC</div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px dashed rgba(255,255,255,0.03)">
      <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px">
        <div style="max-width:60%">
          <strong>Plan a perfect moment</strong>
          <div class="lead" style="font-size:13px">Create a greeting, preview it, then download or share instantly.</div>
        </div>
        <div style="min-width:160px;text-align:right">
          <div class="lead" style="font-size:12px">Share the countdown</div>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
            <button id="shareBtn">Share</button>
            <button id="copyBtn">Copy Link</button>
          </div>
        </div>
      </div>
    </section>

    <aside class="right card right-panel">
      <div class="preview">
        <div class="card-top">
          <div class="spark">26</div>
          <div>
            <div style="font-weight:800">Happy New Year 2026</div>
            <div class="lead" style="font-size:13px">Edit the message below</div>
          </div>
        </div>

        <div id="msg" class="message" contenteditable="true" role="textbox" aria-label="Edit greeting message">Wishing you a joyous 2026 filled with new adventures, success, and bright moments. Happy New Year!</div>

        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div class="lead" style="font-size:13px;margin-bottom:6px">Quick templates</div>
            <div class="templates" id="templates"></div>
          </div>

          <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
            <div style="display:flex;gap:8px">
              <button id="copyMsg">Copy</button>
              <button id="shareMsg">Share</button>
            </div>
            <div style="display:flex;gap:8px">
              <button class="primary" id="downloadBtn">Download PNG</button>
              <button id="fireBtn">Fireworks</button>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top:10px" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>More options</strong>
          <div class="lead">Customize & export</div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
          <button class="tpl" id="festive">Festive</button>
          <button class="tpl" id="romantic">Romantic</button>
          <button class="tpl" id="pro">Professional</button>
          <button class="tpl" id="funny">Funny</button>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px dashed rgba(255,255,255,0.03)">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div class="lead">Auto-trigger fireworks at zero</div>
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="autoFire" checked>On</label>
        </div>
      </div>
    </aside>

    <footer> Developed by 
  <a href="https://www.google.com/search?q=%23manoranjandalai&oq=%23&gs_lcrp=EgZjaHJvbWUqBggBECMYJzIMCAAQRRg5GLEDGIAEMgYIARAjGCcyEAgCEC4YgwEYsQMYgAQYigUyBwgDEAAYgAQyBwgEEAAYgAQyBwgFEAAYgAQyEAgGEAAYgwEYsQMYgAQYigUyCggHEAAYsQMYgAQyCggIEC4YsQMYgAQyCggJEC4YsQMYgATSAQgyNjgxajBqN6gCALACAA&sourceid=chrome&ie=UTF-8&sei=0Q1UabHCJpzc2roPpZyW0A0&zx=1767116245007&no_sw_cr=1"
     target="_blank"
     rel="noopener noreferrer">
    Manoranjan Dalai
  </a>
  â€” Save and share. (Edit & reuse.)</footer>

  </div>

  <!-- Fallback modal shown when clipboard access fails due to permissions policy -->
  <div id="fallback" class="fallback-modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div style="font-weight:800;margin-bottom:8px">Copy link manually</div>
    <textarea id="fallbackText" readonly></textarea>
    <div class="fallback-row">
      <button id="selectBtn" class="btn-ghost">Select All</button>
      <button id="tryCopyBtn" class="btn-ghost">Try Copy</button>
      <button id="closeFallback" class="btn-ghost">Close</button>
    </div>
  </div>

  <script>
    // --------- Helpers: Robust clipboard writes with fallback UI ---------
    async function safeWriteText(text){
      // Try navigator.clipboard first, if available and allowed
      if(navigator.clipboard && navigator.clipboard.writeText){
        try{
          await navigator.clipboard.writeText(text);
          return {ok:true, method:'clipboard'};
        }catch(err){
          // Permission/NotAllowedError or blocked by policy â€” fall through to fallback
          console.warn('clipboard.writeText failed:', err && err.name ? err.name : err);
        }
      }

      // Try execCommand copy (older fallback)
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed'; ta.style.left='-9999px';
        document.body.appendChild(ta);
        ta.select(); ta.setSelectionRange(0, ta.value.length);
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        if(ok) return {ok:true, method:'execCommand'};
      }catch(e){
        console.warn('execCommand copy failed', e);
      }

      // Final fallback: show modal with text for manual copy
      showFallback(text);
      return {ok:false, method:'fallback'};
    }

    function showFallback(text){
      const modal = document.getElementById('fallback');
      const ta = document.getElementById('fallbackText');
      ta.value = text;
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      // focus textarea so user can Ctrl/Cmd+C
      setTimeout(()=> ta.focus(), 50);
    }
    function hideFallback(){
      const modal = document.getElementById('fallback');
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
    }

    document.getElementById('selectBtn').addEventListener('click', ()=>{ const ta=document.getElementById('fallbackText'); ta.select(); });
    document.getElementById('tryCopyBtn').addEventListener('click', async ()=>{
      const text = document.getElementById('fallbackText').value;
      try{
        const res = await safeWriteText(text);
        if(res.ok){ hideFallback(); showToast('Copied! (using ' + res.method + ')'); }
        else showToast('Unable to copy automatically â€” select & copy manually');
      }catch(e){ showToast('Copy failed'); }
    });
    document.getElementById('closeFallback').addEventListener('click', hideFallback);

    // small toast
    function showToast(msg){ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.right='18px'; t.style.bottom='18px'; t.style.background='rgba(10,12,18,0.9)'; t.style.padding='10px 14px'; t.style.borderRadius='8px'; t.style.zIndex=10002; document.body.appendChild(t); setTimeout(()=>t.style.opacity='0',1400); setTimeout(()=>document.body.removeChild(t),2000); }

    // --------- Main app logic (unchanged except using safeWriteText) ---------
    const targetYear = 2026;
    const tzList = [ {label:'UTC',offset:'+00:00'},{label:'India â€” IST',offset:'+05:30'},{label:'USA â€” PST',offset:'-08:00'},{label:'USA â€” EST',offset:'-05:00'},{label:'UK â€” GMT',offset:'+00:00'},{label:'CET (Paris)',offset:'+01:00'},{label:'AEST (Sydney)',offset:'+10:00'},{label:'JST (Tokyo)',offset:'+09:00'},{label:'Local device time',offset:'local'} ];

    const tzEl = document.getElementById('tz');
    const daysEl = document.getElementById('days');
    const hoursEl = document.getElementById('hours');
    const minsEl = document.getElementById('minutes');
    const secsEl = document.getElementById('seconds');
    const targetLabel = document.getElementById('targetLabel');
    const msgBox = document.getElementById('msg');

    let selectedOffset = '+00:00';
    let autoFire = document.getElementById('autoFire').checked;

    function populateTZ(){ tzList.forEach(t=>{ const o=document.createElement('option'); o.value=t.offset; o.textContent=t.label; tzEl.appendChild(o); }); tzEl.value='+00:00'; targetLabel.textContent = tzEl.options[tzEl.selectedIndex].text; }
    populateTZ();
    tzEl.addEventListener('change', ()=>{ selectedOffset = tzEl.value; targetLabel.textContent = tzEl.options[tzEl.selectedIndex].text; updateCountdown(); });
    document.getElementById('localBtn').addEventListener('click', ()=>{ tzEl.value='local'; tzEl.dispatchEvent(new Event('change')); });
    document.getElementById('autoFire').addEventListener('change',(e)=> autoFire = e.target.checked);

    function buildTarget(offset){ if(offset==='local') return new Date(targetYear,0,1,0,0,0,0); return new Date(`${targetYear}-01-01T00:00:00${offset}`); }
    function pad(n){ return n.toString().padStart(2,'0'); }

    let timer = null;
    function updateCountdown(){ if(timer) clearInterval(timer); function tick(){ const now=new Date(); const target=buildTarget(selectedOffset); let diff = target - now; if(diff<0) diff=0; const s=Math.floor(diff/1000); const d=Math.floor(s/(3600*24)); const h=Math.floor((s%(3600*24))/3600); const m=Math.floor((s%3600)/60); const sec=Math.floor(s%60); daysEl.textContent=d; hoursEl.textContent=pad(h); minsEl.textContent=pad(m); secsEl.textContent=pad(sec); if(s===0){ if(autoFire) triggerFireworks(); } } tick(); timer=setInterval(tick,1000); }
    updateCountdown();

    const templates = { Festive:["Wishing you a 2026 sparkling with joy and bright moments. Happy New Year!","Let the fireworks begin â€” cheers to 2026!"], Romantic:["To my loveâ€”may 2026 bring us closer and fill our days with joy.","Happy New Year, darling. Here's to more memories together in 2026."], Professional:["Wishing you a successful and productive 2026.","Happy New Year 2026â€”looking forward to new collaborations."], Funny:["New Year, same me â€” but with better snacks. Happy 2026!","May your 2026 be like your phone battery â€” long lasting and fully charged!"] };
    const tplContainer = document.getElementById('templates'); function renderTemplates(){ tplContainer.innerHTML=''; Object.keys(templates).forEach(cat=>templates[cat].forEach(t=>{ const d=document.createElement('div'); d.className='tpl'; d.textContent = t.length>40? t.slice(0,36)+'...':t; d.title=cat; d.addEventListener('click',()=>{ msgBox.textContent=t; flash(); }); tplContainer.appendChild(d);})); } renderTemplates();
    document.getElementById('festive').addEventListener('click',()=>{ msgBox.textContent = templates.Festive[0]; flash(); });
    document.getElementById('romantic').addEventListener('click',()=>{ msgBox.textContent = templates.Romantic[0]; flash(); });
    document.getElementById('pro').addEventListener('click',()=>{ msgBox.textContent = templates.Professional[0]; flash(); });
    document.getElementById('funny').addEventListener('click',()=>{ msgBox.textContent = templates.Funny[1]; flash(); });
    function flash(){ const el=document.querySelector('.card-top'); if(el && el.animate) el.animate([{transform:'translateY(6px)'},{transform:'translateY(0)'}],{duration:260,easing:'ease-out'}); }

    // copy/share using safeWriteText
    document.getElementById('copyMsg').addEventListener('click', async ()=>{
      const text = msgBox.textContent.trim();
      const res = await safeWriteText(text);
      if(res.ok) showToast('Copied to clipboard ('+res.method+')');
      else showToast('Cannot copy automatically â€” use the popup');
    });

    document.getElementById('shareMsg').addEventListener('click', async ()=>{
      const text = msgBox.textContent.trim() + '\n\nâ€” Happy New Year 2026';
      if(navigator.share){
        try{ await navigator.share({title:'Happy New Year 2026', text}); return; }catch(e){ /* share failed, fall back */ }
      }
      const res = await safeWriteText(text);
      if(res.ok) showToast('Text ready to paste ('+res.method+')');
      else showToast('Share not supported â€” use popup to copy manually');
    });

    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      const url = location.href;
      if(navigator.share){ try{ await navigator.share({title:'Countdown to New Year 2026', text:'Join the countdown!', url}); return; }catch(e){} }
      const res = await safeWriteText(url);
      if(res.ok) showToast('Link copied ('+res.method+')'); else showToast('Unable to copy â€” use popup');
    });

    document.getElementById('copyBtn').addEventListener('click', async ()=>{
      const u = location.origin + location.pathname + '?ny2026';
      const res = await safeWriteText(u);
      if(res.ok) showToast('Share link copied ('+res.method+')'); else showToast('Use popup to copy link');
    });

    function showToast(msg){ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.right='18px'; t.style.bottom='18px'; t.style.background='rgba(10,12,18,0.9)'; t.style.padding='10px 14px'; t.style.borderRadius='8px'; t.style.zIndex=10002; document.body.appendChild(t); setTimeout(()=>t.style.opacity='0',1400); setTimeout(()=>document.body.removeChild(t),2000); }

    // download PNG (unchanged)
    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      const w=1200,h=700; const c=document.createElement('canvas'); c.width=w; c.height=h; const ctx=c.getContext('2d');
      const g=ctx.createLinearGradient(0,0,w,h); g.addColorStop(0,'#071026'); g.addColorStop(1,'#08142a'); ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
      ctx.fillStyle='#fff'; ctx.font='bold 58px Montserrat'; ctx.fillText('Happy New Year 2026',90,140);
      ctx.font='500 32px Montserrat'; wrapText(ctx,msgBox.textContent.trim(),90,220,1020,44);
      const linkUrl = 'https://www.google.com/search?q=%23manoranjandalai&oq=%23&gs_lcrp=EgZjaHJvbWUqBggBECMYJzIMCAAQRRg5GLEDGIAEMgYIARAjGCcyEAgCEC4YgwEYsQMYgAQYigUyBwgDEAAYgAQyBwgEEAAYgAQyBwgFEAAYgAQyEAgGEAAYgwEYsQMYgAQYigUyCggHEAAYsQMYgAQyCggIEC4YsQMYgAQyCggJEC4YsQMYgATSAQgyNjgxajBqN6gCALACAA&sourceid=chrome&ie=UTF-8';
      const text = 'By: Manoranjan...';
      
      ctx.font='600 22px Montserrat'; ctx.fillStyle='rgba(255,255,255,0.7)'; ctx.fillText('By: Manoranjan....',90,640);
      for(let i=0;i<120;i++){ ctx.fillStyle=randomColor(); ctx.beginPath(); ctx.arc(150+Math.random()*900,250+Math.random()*300,3+Math.random()*4,0,Math.PI*2); ctx.fill(); }
      const url=c.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download='Happy_New_Year_2026.png'; a.click();
    });
    function wrapText(ctx,text,x,y,maxWidth,lineH){ const words=text.split(' '); let line='',test='',lines=[]; for(let n=0;n<words.length;n++){ test=line+words[n]+' '; if(ctx.measureText(test).width>maxWidth && n>0){ lines.push(line); line = words[n]+' '; } else { line = test; } } lines.push(line); lines.forEach((ln,i)=> ctx.fillText(ln,x,y+(i*lineH))); }
    function randomColor(){ const a=['#ffd166','#06d6a0','#118ab2','#ef476f','#06b6d4','#a78bfa']; return a[Math.floor(Math.random()*a.length)]; }

    // fireworks & confetti (unchanged)
    const fxCanvas = document.getElementById('fxCanvas'); const fxCtx = fxCanvas.getContext('2d');
    const confCanvas = document.getElementById('confettiCanvas'); const confCtx = confCanvas.getContext('2d');
    let W = window.innerWidth, H = window.innerHeight; function resize(){ W=window.innerWidth; H=window.innerHeight; fxCanvas.width=confCanvas.width=W; fxCanvas.height=confCanvas.height=H; } resize(); window.addEventListener('resize',resize);

    class Firework{ constructor(x,y,color){ this.x=x; this.y=y; this.color=color||randomColor(); this.p=[]; for(let i=0;i<90;i++){ const ang=Math.random()*Math.PI*2; const sp=2+Math.random()*6; this.p.push({x:this.x,y:this.y,vx:Math.cos(ang)*sp,vy:Math.sin(ang)*sp,life:60+Math.random()*60,age:0,size:1+Math.random()*3,color:this.color}); } this.alive=true;} update(){ this.p.forEach(o=>{ o.x+=o.vx; o.y+=o.vy; o.vy+=0.08; o.vx*=0.995; o.vy*=0.995; o.age++; }); this.p=this.p.filter(o=>o.age<o.life); if(this.p.length===0) this.alive=false;} draw(c){ c.save(); c.globalCompositeOperation='lighter'; this.p.forEach(o=>{ c.beginPath(); c.globalAlpha=1-(o.age/o.life); c.fillStyle=o.color; c.arc(o.x,o.y,o.size,0,Math.PI*2); c.fill(); }); c.restore(); }}
    const fireworks=[]; function triggerFireworks(x=W/2,y=H/3){ for(let i=0;i<6;i++){ const nx=(x||Math.random()*W); const ny=(y||Math.random()*H/2); fireworks.push(new Firework(nx,ny,randomColor())); } spawnConfetti(x||W/2,y||H/2,80); }
    function fxLoop(){ fxCtx.clearRect(0,0,W,H); for(let i=fireworks.length-1;i>=0;i--){ fireworks[i].update(); fireworks[i].draw(fxCtx); if(!fireworks[i].alive) fireworks.splice(i,1); } requestAnimationFrame(fxLoop);} fxLoop();
    const confetti=[]; function spawnConfetti(x,y,count=60){ for(let i=0;i<count;i++){ confetti.push({x:x+(Math.random()-0.5)*120,y:y+(Math.random()-0.5)*80,vx:(Math.random()-0.5)*6,vy:(Math.random()*4)-6,r:6+Math.random()*8,color:randomColor(),rot:Math.random()*360,drag:0.99}); } }
    function confettiLoop(){ confCtx.clearRect(0,0,W,H); for(let i=confetti.length-1;i>=0;i--){ const c=confetti[i]; c.vx*=c.drag; c.vy+=0.25; c.x+=c.vx; c.y+=c.vy; c.rot+=c.vx; confCtx.save(); confCtx.translate(c.x,c.y); confCtx.rotate(c.rot*Math.PI/180); confCtx.fillStyle=c.color; confCtx.fillRect(-c.r/2,-c.r/2,c.r,c.r*0.6); confCtx.restore(); if(c.y>H+60) confetti.splice(i,1); } requestAnimationFrame(confettiLoop);} confettiLoop();
    document.getElementById('fireBtn').addEventListener('click',()=>triggerFireworks());

    // sound chime
    const audioCtx = window.AudioContext ? new AudioContext() : null; let chime=true; document.getElementById('toggleSound').addEventListener('click',()=>{ chime=!chime; document.getElementById('toggleSound').style.opacity=chime?1:0.5; if(chime) playChime(); });
    function playChime(){ if(!audioCtx||!chime) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(audioCtx.destination); g.gain.setValueAtTime(0,audioCtx.currentTime); g.gain.linearRampToValueAtTime(0.08,audioCtx.currentTime+0.02); o.start(); g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.6); o.stop(audioCtx.currentTime+0.65); }
    function stopChime(){ if(audioCtx) audioCtx.suspend(); }

    // paste handling
    msgBox.addEventListener('paste',e=>{ e.preventDefault(); const t=(e.clipboardData||window.clipboardData).getData('text'); document.execCommand('insertText',false,t); });

    // initial confetti
    window.addEventListener('load',()=>{ spawnConfetti(window.innerWidth/2,window.innerHeight/3,60); });

  </script>
</body>
</html>
